apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-annotation-espconfig-service-transformer
patch: |-
  - op: replace
    path: /spec/projectTemplate/httpService/metadata/annotations/prometheus.io~1port
    value: "443"
  - op: replace
    path: /spec/projectTemplate/httpService/metadata/annotations/prometheus.io~1scheme
    value: "https"
target:
  kind: ESPConfig
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-batchjob-backup-restore-base-tls-volumemount-transformer
patch: |-
  - op: add
    path: /spec/template/spec/containers/1/volumeMounts/-
    value:
      name: security
      mountPath: /security
  - op: add
    path: /spec/template/spec/containers/1/volumeMounts/-
    value:
      name: security
      mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
      subPath: cacerts
  - op: add
    path: /spec/template/spec/containers/1/volumeMounts/-
    value:
      name: security
      mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
      subPath: private
target:
  annotationSelector: sas.com/component-name=sas-backup-job
  kind: Job
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-batchjob-backup-restore-full-tls-pem-configmap-transformer
patch: |-
  - op: add
    path: /spec/template/spec/containers/1/envFrom/-
    value:
      configMapRef:
        name: sas-tls-config
target:
  annotationSelector: sas.com/component-name=sas-backup-job
  kind: Job
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-batchjob-base-tls-certframe-transformer
patch: |-
  kind: Job
  metadata:
    name: wildcard
  spec:
    template:
      spec:
        initContainers:
        - name: sas-certframe
          image: sas-certframe
          envFrom:
          - configMapRef:
              name: sas-certframe-ingress-certificate-config
          env:
          - name: KUBE_POD_NAME
            valueFrom:
              fieldRef:
                fieldPath: metadata.name
          - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
            value: /customer-provided-ca-certificates
          volumeMounts:
          - name: security
            mountPath: /security
          - name: customer-provided-ca-certificates
            mountPath: /customer-provided-ca-certificates
          securityContext:
            allowPrivilegeEscalation: false
            privileged: false
            readOnlyRootFilesystem: true
        volumes:
        - name: security
          emptyDir: {}
        - name: customer-provided-ca-certificates
          configMap:
            name: sas-customer-provided-ca-certificates
target:
  annotationSelector: sas.com/certificate-file-format in (pem, jks)
  kind: Job
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-batchjob-base-tls-volumemount-transformer
patch: |-
  - op: add
    path: /spec/template/spec/containers/0/volumeMounts/-
    value:
      name: security
      mountPath: /security
  - op: add
    path: /spec/template/spec/containers/0/volumeMounts/-
    value:
      name: security
      mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
      subPath: cacerts
  - op: add
    path: /spec/template/spec/containers/0/volumeMounts/-
    value:
      name: security
      mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
      subPath: private
target:
  annotationSelector: sas.com/certificate-file-format in (pem, jks)
  kind: Job
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-batchjob-configuration-restore-base-tls-certframe-transformer
patch: "- op: add\n  path: /spec/template/spec/initContainers/-\n  value:\n    name:
  sas-certframe-for-configuration\n    image: sas-certframe\n    envFrom:\n    - configMapRef:\n
  \       name: sas-certframe-ingress-certificate-config\n    env:\n    - name: KUBE_POD_NAME\n
  \     valueFrom:\n        fieldRef:\n          fieldPath: metadata.name\n    - name:
  SAS_ADDITIONAL_CA_CERTIFICATES_DIR\n      value: /customer-provided-ca-certificates\n
  \   - name: SAS_CERTIFICATE_FILE_FORMAT\n      value: jks\n    volumeMounts:\n    -
  name: security-for-configuration\n      mountPath: /security\n    - name: customer-provided-ca-certificates\n
  \     mountPath: /customer-provided-ca-certificates\n    securityContext:\n      allowPrivilegeEscalation:
  false\n      privileged: false\n      readOnlyRootFilesystem: true      \n- op:
  add\n  path: /spec/template/spec/volumes/-\n  value:\n    name: security-for-configuration\n
  \   emptyDir: {}"
target:
  annotationSelector: sas.com/component-name=sas-restore-job
  kind: Job
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-batchjob-configuration-restore-base-tls-volumemount-transformer
patch: |-
  - op: add
    path: /spec/template/spec/containers/1/volumeMounts/-
    value:
      name: security-for-configuration
      mountPath: /security
  - op: add
    path: /spec/template/spec/containers/1/volumeMounts/-
    value:
      name: security-for-configuration
      mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
      subPath: cacerts
  - op: add
    path: /spec/template/spec/containers/1/volumeMounts/-
    value:
      name: security-for-configuration
      mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
      subPath: private
target:
  annotationSelector: sas.com/component-name=sas-restore-job
  kind: Job
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-batchjob-configuration-restore-full-tls-transformer
patch: |-
  - op: add
    path: /spec/template/spec/containers/1/envFrom/-
    value:
      configMapRef:
        name: sas-java-tls-config
  - op: add
    path: /spec/template/spec/initContainers/1/envFrom/-
    value:
      configMapRef:
        name: sas-certframe-user-config
  - op: add
    path: /spec/template/spec/initContainers/1/envFrom/-
    value:
      configMapRef:
        name: sas-certframe-java-config
target:
  annotationSelector: sas.com/component-name=sas-restore-job
  kind: Job
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-batchjob-full-tls-certframe-transformer
patch: |-
  - op: add
    path: /spec/template/metadata/annotations/sas.com~1tls-enabled-ports
    value: all
  - op: add
    path: /spec/template/spec/initContainers/0/envFrom/-
    value:
      configMapRef:
        name: sas-certframe-user-config
target:
  annotationSelector: sas.com/certificate-file-format in (pem, jks)
  kind: Job
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-batchjob-full-tls-jks-configmap-transformer
patch: |-
  - op: add
    path: /spec/template/spec/containers/0/envFrom/-
    value:
      configMapRef:
        name: sas-java-tls-config
  - op: add
    path: /spec/template/spec/initContainers/0/envFrom/-
    value:
      configMapRef:
        name: sas-certframe-java-config
target:
  annotationSelector: sas.com/certificate-file-format=jks
  kind: Job
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-batchjob-full-tls-pem-configmap-transformer
patch: |-
  - op: add
    path: /spec/template/spec/containers/0/envFrom/-
    value:
      configMapRef:
        name: sas-tls-config
  - op: add
    path: /spec/template/spec/initContainers/0/envFrom/-
    value:
      configMapRef:
        name: sas-certframe-config
target:
  annotationSelector: sas.com/certificate-file-format=pem
  kind: Job
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-casdeployment-backup-agent-base-tls-transformer
patch: |-
  - op: add
    path: /spec/controllerTemplate/spec/containers/2/volumeMounts/-
    value:
      name: security
      mountPath: /security
  - op: add
    path: /spec/controllerTemplate/spec/containers/2/volumeMounts/-
    value:
      name: security
      mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
      subPath: cacerts
  - op: add
    path: /spec/controllerTemplate/spec/containers/2/volumeMounts/-
    value:
      name: security
      mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
      subPath: private
target:
  kind: CASDeployment
  labelSelector: sas.com/backup-role=provider
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-casdeployment-backup-agent-full-tls-transformer
patch: |-
  - op: add
    path: /spec/controllerTemplate/spec/containers/2/envFrom/-
    value:
      configMapRef:
        name: sas-tls-config
target:
  kind: CASDeployment
  labelSelector: sas.com/backup-role=provider
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-casdeployment-base-tls-certframe-transformer
patch: |-
  - op: add
    path: /spec/controllerTemplate/spec/initContainers/0
    value:
      name: sas-certframe
      image: sas-certframe
      env:
      - name: KUBE_POD_NAME
        valueFrom:
          fieldRef:
            fieldPath: metadata.name
      - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
        value: /customer-provided-ca-certificates
      envFrom:
      - configMapRef:
          name: sas-certframe-ingress-certificate-config
      volumeMounts:
      - name: security
        mountPath: /security
      - name: customer-provided-ca-certificates
        mountPath: /customer-provided-ca-certificates
      securityContext:
        allowPrivilegeEscalation: false
        privileged: false
        readOnlyRootFilesystem: true
target:
  kind: CASDeployment
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-casdeployment-base-tls-sssd-transformer
patch: |-
  - op: add
    path: /spec/controllerTemplate/spec/containers/1/volumeMounts/-
    value:
      name: security
      mountPath: /security
  - op: add
    path: /spec/controllerTemplate/spec/containers/1/volumeMounts/-
    value:
      name: security
      mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
      subPath: cacerts
  - op: add
    path: /spec/controllerTemplate/spec/containers/1/volumeMounts/-
    value:
      name: security
      mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
      subPath: private
target:
  kind: CASDeployment
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-casdeployment-base-tls-transformer
patch: |-
  - op: add
    path: /spec/controllerTemplate/spec/containers/0/volumeMounts/-
    value:
      name: security
      mountPath: /security
  - op: add
    path: /spec/controllerTemplate/spec/containers/0/volumeMounts/-
    value:
      name: security
      mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
      subPath: cacerts
  - op: add
    path: /spec/controllerTemplate/spec/containers/0/volumeMounts/-
    value:
      name: security
      mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
      subPath: private
  - op: add
    path: /spec/controllerTemplate/spec/volumes/-
    value:
      name: security
      emptyDir: {}
  - op: add
    path: /spec/controllerTemplate/spec/volumes/-
    value:
      name: customer-provided-ca-certificates
      configMap:
        name: sas-customer-provided-ca-certificates
  - op: add
    path: /spec/controllerTemplate/metadata
    value:
      annotations:
        sas.com/certificate-file-format: pem
target:
  kind: CASDeployment
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-casdeployment-config-init-initcontainer-base-tls-transformer
patch: |-
  - op: add
    path: /spec/controllerTemplate/spec/initContainers/1/env/-
    value:
      name: SSL_CERT_FILE
      value: /security/trustedcerts.pem
  - op: add
    path: /spec/controllerTemplate/spec/initContainers/1/volumeMounts/-
    value:
      name: security
      mountPath: /security
target:
  annotationSelector: sas.com/config-init-mode=initcontainer
  kind: CASDeployment
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-casdeployment-full-tls-sssd-transformer
patch: |-
  - op: add
    path: /spec/controllerTemplate/spec/containers/1/envFrom/-
    value:
      configMapRef:
        name: sas-tls-config
target:
  kind: CASDeployment
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-casdeployment-full-tls-transformer
patch: |-
  - op: add
    path: /spec/controllerTemplate/metadata/annotations/sas.com~1tls-enabled-ports
    value: all
  - op: replace
    path: /spec/controllerTemplate/metadata/annotations/prometheus.io~1scheme
    value: https
  - op: add
    path: /spec/controllerTemplate/spec/containers/0/envFrom/-
    value:
      configMapRef:
        name: sas-tls-config
  - op: replace
    path: /spec/controllerTemplate/spec/containers/0/readinessProbe/httpGet/scheme
    value: HTTPS
  - op: add
    path: /spec/controllerTemplate/spec/initContainers/0/env/-
    value:
      name: SAS_CERTIFICATE_PRIVATE_KEY_PERMISSIONS
      value: "644"
  - op: add
    path: /spec/controllerTemplate/spec/initContainers/0/envFrom/-
    value:
      configMapRef:
        name: sas-certframe-user-config
  - op: add
    path: /spec/controllerTemplate/spec/initContainers/0/envFrom/-
    value:
      configMapRef:
        name: sas-certframe-config
  - op: add
    path: /spec/ingressTemplate/metadata/annotations/nginx.ingress.kubernetes.io~1backend-protocol
    value: HTTPS
target:
  kind: CASDeployment
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-cronjob-backup-restore-base-tls-volumemount-transformer
patch: |-
  - op: add
    path: /spec/jobTemplate/spec/template/spec/containers/1/volumeMounts/-
    value:
      name: security
      mountPath: /security
  - op: add
    path: /spec/jobTemplate/spec/template/spec/containers/1/volumeMounts/-
    value:
      name: security
      mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
      subPath: cacerts
  - op: add
    path: /spec/jobTemplate/spec/template/spec/containers/1/volumeMounts/-
    value:
      name: security
      mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
      subPath: private
target:
  annotationSelector: sas.com/component-name=sas-backup-job
  kind: CronJob
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-cronjob-backup-restore-full-tls-transformer
patch: |-
  - op: add
    path: /spec/jobTemplate/spec/template/spec/containers/1/envFrom/-
    value:
      configMapRef:
        name: sas-tls-config
target:
  annotationSelector: sas.com/component-name in (sas-backup-job)
  kind: CronJob
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-cronjob-base-tls-certframe-transformer
patch: |-
  kind: CronJob
  metadata:
    name: wildcard
  spec:
    jobTemplate:
      spec:
        template:
          spec:
            initContainers:
            - name: sas-certframe
              image: sas-certframe
              env:
              - name: KUBE_POD_NAME
                valueFrom:
                  fieldRef:
                    fieldPath: metadata.name
              - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
                value: /customer-provided-ca-certificates
              envFrom:
              - configMapRef:
                  name: sas-certframe-ingress-certificate-config
              volumeMounts:
              - name: security
                mountPath: /security
              - name: customer-provided-ca-certificates
                mountPath: /customer-provided-ca-certificates
              securityContext:
                allowPrivilegeEscalation: false
                privileged: false
                readOnlyRootFilesystem: true
            volumes:
            - name: security
              emptyDir: {}
            - name: customer-provided-ca-certificates
              configMap:
                name: sas-customer-provided-ca-certificates
target:
  annotationSelector: sas.com/certificate-file-format in (pem, jks)
  kind: CronJob
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-cronjob-base-tls-volumemount-transformer
patch: |-
  - op: add
    path: /spec/jobTemplate/spec/template/spec/containers/0/volumeMounts/-
    value:
      name: security
      mountPath: /security
  - op: add
    path: /spec/jobTemplate/spec/template/spec/containers/0/volumeMounts/-
    value:
      name: security
      mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
      subPath: cacerts
  - op: add
    path: /spec/jobTemplate/spec/template/spec/containers/0/volumeMounts/-
    value:
      name: security
      mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
      subPath: private
target:
  annotationSelector: sas.com/certificate-file-format in (pem, jks)
  kind: CronJob
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-cronjob-full-tls-certframe-transformer
patch: |-
  - op: add
    path: /spec/jobTemplate/spec/template/metadata/annotations/sas.com~1tls-enabled-ports
    value: all
  - op: add
    path: /spec/jobTemplate/spec/template/spec/initContainers/0/envFrom/-
    value:
      configMapRef:
        name: sas-certframe-user-config
target:
  annotationSelector: sas.com/certificate-file-format in (pem, jks)
  kind: CronJob
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-cronjob-full-tls-jks-configmap-transformer
patch: |-
  - op: add
    path: /spec/jobTemplate/spec/template/spec/containers/0/envFrom/-
    value:
      configMapRef:
        name: sas-java-tls-config
  - op: add
    path: /spec/jobTemplate/spec/template/spec/initContainers/0/envFrom/-
    value:
      configMapRef:
        name: sas-certframe-java-config
target:
  annotationSelector: sas.com/certificate-file-format=jks
  kind: CronJob
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-cronjob-full-tls-pem-configmap-transformer
patch: |-
  - op: add
    path: /spec/jobTemplate/spec/template/spec/containers/0/envFrom/-
    value:
      configMapRef:
        name: sas-tls-config
  - op: add
    path: /spec/jobTemplate/spec/template/spec/initContainers/0/envFrom/-
    value:
      configMapRef:
        name: sas-certframe-config
target:
  annotationSelector: sas.com/certificate-file-format=pem
  kind: CronJob
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-deployment-base-tls-certframe-transformer
patch: |-
  kind: Deployment
  metadata:
    name: wildcard
  spec:
    template:
      spec:
        initContainers:
        - name: sas-certframe
          image: sas-certframe
          env:
          - name: KUBE_POD_NAME
            valueFrom:
              fieldRef:
                fieldPath: metadata.name
          - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
            value: /customer-provided-ca-certificates
          envFrom:
          - configMapRef:
              name: sas-certframe-ingress-certificate-config
          volumeMounts:
          - name: security
            mountPath: /security
          - name: customer-provided-ca-certificates
            mountPath: /customer-provided-ca-certificates
          securityContext:
            allowPrivilegeEscalation: false
            privileged: false
            readOnlyRootFilesystem: true
        volumes:
        - name: security
          emptyDir: {}
        - name: customer-provided-ca-certificates
          configMap:
            name: sas-customer-provided-ca-certificates
target:
  annotationSelector: sas.com/certificate-file-format in (pem, jks)
  kind: Deployment
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-deployment-base-tls-volumemount-transformer
patch: |-
  - op: add
    path: /spec/template/spec/containers/0/volumeMounts/-
    value:
      name: security
      mountPath: /security
  - op: add
    path: /spec/template/spec/containers/0/volumeMounts/-
    value:
      name: security
      mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
      subPath: cacerts
  - op: add
    path: /spec/template/spec/containers/0/volumeMounts/-
    value:
      name: security
      mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
      subPath: private
target:
  annotationSelector: sas.com/certificate-file-format in (pem, jks)
  kind: Deployment
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-deployment-cachelocator-full-tls-consul-registration-transformer
patch: |-
  - op: replace
    path: /spec/template/spec/containers/0/env/2
    value:
      name: JAVA_OPTION_SPRING_CLOUD_CONSUL_DISCOVERY_PORT
      value: -Dspring.cloud.consul.discovery.port=443
target:
  kind: Deployment
  name: sas-cachelocator
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-deployment-compsrv-full-tls-private-key-transformer
patch: |-
  - op: add
    path: /spec/template/spec/containers/0/env/-
    value:
      name: SSLPVTKEYPASS
      value: ""
  - op: add
    path: /spec/template/spec/initContainers/0/env/-
    value:
      name: SAS_CERTIFICATE_PRIVATE_KEY_PERMISSIONS
      value: "644"
target:
  kind: Deployment
  name: compsrv
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-deployment-config-init-initcontainer-base-tls-transformer
patch: |-
  kind: Deployment
  metadata:
    name: wildcard
  spec:
    template:
      spec:
        initContainers:
        - name: sas-config-init
          env:
          - name: SSL_CERT_FILE
            value: /security/trustedcerts.pem
          volumeMounts:
          - name: security
            mountPath: /security
target:
  annotationSelector: sas.com/config-init-mode=initcontainer
  kind: Deployment
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-deployment-config-init-sidecar-base-tls-transformer
patch: |-
  kind: Deployment
  metadata:
    name: wildcard
  spec:
    template:
      spec:
        containers:
        - name: sas-config-init
          env:
          - name: SSL_CERT_FILE
            value: /security/trustedcerts.pem
          volumeMounts:
          - name: security
            mountPath: /security
target:
  annotationSelector: sas.com/config-init-mode=sidecar
  kind: Deployment
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-deployment-connect-config-setup-base-tls-transformer
patch: |-
  kind: Deployment
  metadata:
    name: wildcard
  spec:
    template:
      spec:
        initContainers:
        - name: sas-connect-config-setup
          env:
          - name: SSL_CERT_FILE
            value: /security/trustedcerts.pem
          volumeMounts:
          - name: security
            mountPath: /security
target:
  kind: Deployment
  name: sas-connect-spawner
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-deployment-connect-spawner-tls-private-key-transformer
patch: |-
  - op: add
    path: /spec/template/spec/initContainers/0/env/-
    value:
      name: SAS_CERTIFICATE_PRIVATE_KEY_PERMISSIONS
      value: "644"
target:
  kind: Deployment
  name: sas-connect-spawner
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-deployment-dbmigrator-base-tls-transformer
patch: |-
  kind: Deployment
  metadata:
    name: wildcard
  spec:
    template:
      spec:
        initContainers:
        - name: sas-db-migrator
          env:
          - name: SSL_CERT_FILE
            value: /security/trustedcerts.pem
          volumeMounts:
          - name: security
            mountPath: /security
target:
  annotationSelector: sas.com/pod-uses-db-migrator=true
  kind: Deployment
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-deployment-full-tls-certframe-transformer
patch: |-
  - op: add
    path: /spec/template/metadata/annotations/sas.com~1tls-enabled-ports
    value: all
  - op: replace
    path: /spec/template/metadata/annotations/prometheus.io~1scheme
    value: https
  - op: add
    path: /spec/template/spec/initContainers/0/envFrom/-
    value:
      configMapRef:
        name: sas-certframe-user-config
target:
  annotationSelector: sas.com/certificate-file-format in (pem, jks)
  kind: Deployment
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-deployment-full-tls-certframe-transformer-prometheus-esp-operator
patch: |-
  - op: replace
    path: /spec/template/metadata/annotations/prometheus.io~1scheme
    value: http
target:
  kind: Deployment
  name: sas-esp-operator
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-deployment-full-tls-jks-configmap-transformer
patch: |-
  - op: add
    path: /spec/template/spec/containers/0/envFrom/-
    value:
      configMapRef:
        name: sas-java-tls-config
  - op: add
    path: /spec/template/spec/initContainers/0/envFrom/-
    value:
      configMapRef:
        name: sas-certframe-java-config
target:
  annotationSelector: sas.com/certificate-file-format=jks
  kind: Deployment
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-deployment-full-tls-pem-configmap-transformer
patch: |-
  - op: add
    path: /spec/template/spec/containers/0/envFrom/-
    value:
      configMapRef:
        name: sas-tls-config
  - op: add
    path: /spec/template/spec/initContainers/0/envFrom/-
    value:
      configMapRef:
        name: sas-certframe-config
target:
  annotationSelector: sas.com/certificate-file-format=pem
  kind: Deployment
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-deployment-sssd-base-tls-transformer
patch: |-
  kind: Deployment
  metadata:
    name: wildcard
  spec:
    template:
      spec:
        containers:
        - name: sssd
          env:
          - name: SSL_CERT_FILE
            value: /security/trustedcerts.pem
          volumeMounts:
          - name: security
            mountPath: /security
target:
  annotationSelector: sas.com/pod-uses-sssd=true
  kind: Deployment
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-drive-ingress-full-tls-port-transformer
patch: |-
  - op: replace
    path: /spec/rules/0/http/paths/1/backend/servicePort
    value: 443
target:
  kind: Ingress
  name: sas-drive-app
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-espconfig-base-tls-certframe-transformer
patch: |-
  kind: ESPConfig
  metadata:
    name: wildcard
  spec:
    projectTemplate:
      deployment:
        spec:
          template:
            spec:
              initContainers:
              - name: sas-certframe
                image: sas-certframe
                env:
                - name: KUBE_POD_NAME
                  valueFrom:
                    fieldRef:
                      fieldPath: metadata.name
                - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
                  value: /customer-provided-ca-certificates
                envFrom:
                - configMapRef:
                    name: sas-certframe-ingress-certificate-config
                volumeMounts:
                - name: security
                  mountPath: /security
                - name: customer-provided-ca-certificates
                  mountPath: /customer-provided-ca-certificates
                securityContext:
                  allowPrivilegeEscalation: false
                  privileged: false
                  readOnlyRootFilesystem: true
target:
  kind: ESPConfig
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-espconfig-base-tls-transformer
patch: |-
  - op: add
    path: /spec/projectTemplate/deployment/spec/template/spec/containers/0/volumeMounts/-
    value:
      name: security
      mountPath: /security
  - op: add
    path: /spec/projectTemplate/deployment/spec/template/spec/containers/0/volumeMounts/-
    value:
      name: security
      mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
      subPath: cacerts
  - op: add
    path: /spec/projectTemplate/deployment/spec/template/spec/containers/0/volumeMounts/-
    value:
      name: security
      mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
      subPath: private
  - op: add
    path: /spec/projectTemplate/deployment/spec/template/spec/volumes/-
    value:
      name: security
      emptyDir: {}
  - op: add
    path: /spec/projectTemplate/deployment/spec/template/spec/volumes/-
    value:
      name: customer-provided-ca-certificates
      configMap:
        name: sas-customer-provided-ca-certificates
target:
  kind: ESPConfig
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-espconfig-full-tls-transformer
patch: |-
  - op: add
    path: /spec/espProperties/security.http_ssl_enabled
    value: "true"
  - op: add
    path: /spec/espProperties/security.pubsub_ssl_enabled
    value: "true"
  - op: add
    path: /spec/espProperties/env.security.server.server_cert_file
    value: "SAS_CERTIFICATE_FILE"
  - op: add
    path: /spec/espProperties/env.security.server.server_key_file
    value: "SAS_CERTIFICATE_PRIVATE_KEY_FILE"
  - op: add
    path: /spec/projectTemplate/deployment/spec/template/metadata/annotations/sas.com~1tls-enabled-ports
    value: all
  - op: replace
    path: /spec/projectTemplate/deployment/spec/template/metadata/annotations/prometheus.io~1scheme
    value: https
  - op: add
    path: /spec/projectTemplate/deployment/spec/template/spec/containers/0/envFrom/-
    value:
      configMapRef:
        name: sas-tls-config
  - op: replace
    path: /spec/projectTemplate/deployment/spec/template/spec/containers/0/readinessProbe/httpGet/scheme
    value: HTTPS
  - op: add
    path: /spec/projectTemplate/deployment/spec/template/spec/initContainers/0/envFrom/-
    value:
      configMapRef:
        name: sas-certframe-user-config
  - op: add
    path: /spec/projectTemplate/deployment/spec/template/spec/initContainers/0/envFrom/-
    value:
      configMapRef:
        name: sas-certframe-config
target:
  kind: ESPConfig
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-go-configmap-consul-http-addr-tls-transformer
patch: |-
  - op: replace
    path: /data/CONSUL_HTTP_ADDR
    value: https://sas-consul-server:8500
target:
  kind: ConfigMap
  name: sas-go-config
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-ingress-espconfig-full-tls-port-transformer
patch: |-
  - op: replace
    path: /spec/projectTemplate/ingress/spec/rules/0/http/paths/0/backend/servicePort
    value: 443
target:
  kind: ESPConfig
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-ingress-espconfig-full-tls-transformer
patch: |-
  kind: ESPConfig
  metadata:
    name: wildcard
  spec:
    projectTemplate:
      ingress:
        metadata:
          annotations:
            nginx.ingress.kubernetes.io/backend-protocol: HTTPS
target:
  kind: ESPConfig
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-ingress-full-tls-port-transformer
patch: |-
  - op: replace
    path: /spec/rules/0/http/paths/0/backend/servicePort
    value: 443
target:
  annotationSelector: sas.com/kustomize-base=base
  kind: Ingress
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-ingress-full-tls-transformer
patch: |-
  kind: Ingress
  metadata:
    name: wildcard
    annotations:
      nginx.ingress.kubernetes.io/backend-protocol: HTTPS
target:
  kind: Ingress
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-java-configmap-consul-http-addr-tls-transformer
patch: |-
  - op: replace
    path: /data/CONSUL_HTTP_ADDR
    value: https://sas-consul-server:8500
target:
  kind: ConfigMap
  name: sas-java-config
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-job-pgoclient-full-tls-certframe-transformer
patch: |-
  - op: replace
    path: /spec/template/spec/containers/0/env/4
    value:
      name: DISABLE_TLS
      value: "false"
  - op: replace
    path: /spec/template/spec/containers/0/env/0
    value:
      name: PGO_APISERVER_URL
      value: https://sas-crunchy-data-postgres-operator:8443
  - op: add
    path: /spec/template/spec/containers/0/volumeMounts/-
    value:
      name: pgo-tls
      mountPath: /tmp
  - op: add
    path: /spec/template/spec/volumes/-
    value:
      name: pgo-tls
      secret:
        secretName: pgo.tls
target:
  kind: Job
  name: sas-crunchy-data-pgo-client
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-model-studio-app-ingress-full-tls-port-transformer
patch: |-
  - op: replace
    path: /spec/rules/0/http/paths/1/backend/servicePort
    value: 443
target:
  kind: Ingress
  name: sas-model-studio-app
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-pgcluster-base-tls-certframe-transformer
patch: "kind: Pgcluster\nmetadata:\n  name: wildcard\nspec:\n  certframe:\n    containers:\n
  \   - envFrom: []\n      volumeMounts:\n      - name: security\n        mountPath:
  /security  \n    initContainers:\n    - name: sas-certframe\n      image: sas-certframe\n
  \     env:\n      - name: KUBE_POD_NAME\n        valueFrom:\n          fieldRef:\n
  \           fieldPath: metadata.name\n      - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR\n
  \       value: /customer-provided-ca-certificates\n      envFrom:\n      - configMapRef:\n
  \         name: sas-certframe-ingress-certificate-config\n      volumeMounts:\n
  \     - name: security\n        mountPath: /security\n      - name: customer-provided-ca-certificates\n
  \       mountPath: /customer-provided-ca-certificates\n      securityContext:\n
  \       allowPrivilegeEscalation: false\n        privileged: false\n        readOnlyRootFilesystem:
  true\n    volumes:\n    - name: security\n      emptyDir: {}\n    - name: customer-provided-ca-certificates\n
  \     configMap:\n        name: sas-customer-provided-ca-certificates"
target:
  kind: Pgcluster
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-pgcluster-cpspostgres-full-tls-transformer
patch: |-
  - op: add
    path: /spec/tls/caSecret
    value: sas-crunchy-data-cpspostgres-tls-secret
  - op: add
    path: /spec/tls/tlsSecret
    value: sas-crunchy-data-cpspostgres-tls-secret
target:
  kind: Pgcluster
  name: sas-crunchy-data-cpspostgres
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-pgcluster-full-tls-certframe-transformer
patch: |-
  - op: add
    path: /spec/certframe/containers/0/envFrom/-
    value:
      configMapRef:
        name: sas-tls-config
  - op: add
    path: /spec/certframe/initContainers/0/env/-
    value:
      name: SAS_CERTIFICATE_SECRET_NAME
      value: "{{.ClusterName}}-tls-secret"
  - op: add
    path: /spec/certframe/initContainers/0/envFrom/-
    value:
      configMapRef:
        name: sas-certframe-user-config
  - op: add
    path: /spec/certframe/initContainers/0/envFrom/-
    value:
      configMapRef:
        name: sas-certframe-config
target:
  kind: Pgcluster
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-pgcluster-postgres-full-tls-transformer
patch: |-
  - op: add
    path: /spec/tls/caSecret
    value: sas-crunchy-data-postgres-tls-secret
  - op: add
    path: /spec/tls/tlsSecret
    value: sas-crunchy-data-postgres-tls-secret
target:
  kind: Pgcluster
  name: sas-crunchy-data-postgres
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-podtemplate-base-tls-certframe-transformer
patch: |-
  kind: PodTemplate
  metadata:
    name: wildcard
  template:
    spec:
      initContainers:
      - name: sas-certframe
        image: sas-certframe
        env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: /customer-provided-ca-certificates
        envFrom:
        - configMapRef:
            name: sas-certframe-ingress-certificate-config
        volumeMounts:
        - name: security
          mountPath: /security
        - name: customer-provided-ca-certificates
          mountPath: /customer-provided-ca-certificates
        securityContext:
          allowPrivilegeEscalation: false
          privileged: false
          readOnlyRootFilesystem: true
      volumes:
      - name: security
        emptyDir: {}
      - name: customer-provided-ca-certificates
        configMap:
          name: sas-customer-provided-ca-certificates
target:
  annotationSelector: sas.com/certificate-file-format in (pem, jks)
  kind: PodTemplate
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-podtemplate-base-tls-volumemount-transformer
patch: |-
  - op: add
    path: /template/spec/containers/0/volumeMounts/-
    value:
      name: security
      mountPath: /security
  - op: add
    path: /template/spec/containers/0/volumeMounts/-
    value:
      name: security
      mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
      subPath: cacerts
  - op: add
    path: /template/spec/containers/0/volumeMounts/-
    value:
      name: security
      mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
      subPath: private
target:
  annotationSelector: sas.com/certificate-file-format in (pem, jks)
  kind: PodTemplate
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-podtemplate-config-init-initcontainer-base-tls-transformer
patch: |-
  kind: PodTemplate
  metadata:
    name: wildcard
  template:
    spec:
      initContainers:
      - name: sas-config-init
        env:
        - name: SSL_CERT_FILE
          value: /security/trustedcerts.pem
        volumeMounts:
        - name: security
          mountPath: /security
target:
  annotationSelector: sas.com/config-init-mode=initcontainer
  kind: PodTemplate
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-podtemplate-config-init-sidecar-base-tls-transformer
patch: |-
  kind: PodTemplate
  metadata:
    name: wildcard
  template:
    spec:
      containers:
      - name: sas-config-init
        env:
        - name: SSL_CERT_FILE
          value: /security/trustedcerts.pem
        volumeMounts:
        - name: security
          mountPath: /security
target:
  annotationSelector: sas.com/config-init-mode=sidecar
  kind: PodTemplate
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-podtemplate-full-tls-certframe-transformer
patch: |-
  - op: add
    path: /template/metadata/annotations/sas.com~1tls-enabled-ports
    value: all
  - op: add
    path: /template/spec/initContainers/0/envFrom/-
    value:
      configMapRef:
        name: sas-certframe-user-config
target:
  annotationSelector: sas.com/certificate-file-format in (pem, jks)
  kind: PodTemplate
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-podtemplate-full-tls-jks-configmap-transformer
patch: |-
  - op: add
    path: /template/spec/containers/0/envFrom/-
    value:
      configMapRef:
        name: sas-java-tls-config
  - op: add
    path: /template/spec/initContainers/0/envFrom/-
    value:
      configMapRef:
        name: sas-certframe-java-config
target:
  annotationSelector: sas.com/certificate-file-format=jks
  kind: PodTemplate
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-podtemplate-full-tls-pem-configmap-transformer
patch: |-
  - op: add
    path: /template/spec/containers/0/envFrom/-
    value:
      configMapRef:
        name: sas-tls-config
  - op: add
    path: /template/spec/initContainers/0/envFrom/-
    value:
      configMapRef:
        name: sas-certframe-config
target:
  annotationSelector: sas.com/certificate-file-format=pem
  kind: PodTemplate
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-postgres-configmap-tls-transformer
patch: |-
  - op: add
    path: /data/CONSUL_HTTP_ADDR
    value: https://sas-consul-server:8500
  - op: add
    path: /data/SSL_CERT_FILE
    value: /security/trustedcerts.pem
  - op: replace
    path: /data/DATABASE_SSL_ENABLED
    value: "true"
  - op: add
    path: /data/REQUESTS_CA_BUNDLE
    value: /security/trustedcerts.pem
  - op: add
    path: /data/POSTGRES_OPERATOR_SERVICE_SCHEME
    value: https
target:
  kind: ConfigMap
  name: sas-postgres-config
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-postgres-operator-full-tls-transformer
patch: |-
  - op: replace
    path: /spec/template/spec/containers/0/env/5
    value:
      name: TLS_CA_TRUST
      value: /security/trustedcerts.pem
  - op: replace
    path: /spec/template/spec/containers/0/env/6
    value:
      name: TLS_NO_VERIFY
      value: "false"
  - op: remove
    path: /spec/template/spec/containers/0/env/7
  - op: replace
    path: /spec/template/spec/containers/0/livenessProbe/httpGet/scheme
    value: HTTPS
  - op: replace
    path: /spec/template/spec/containers/0/readinessProbe/httpGet/scheme
    value: HTTPS
  - op: add
    path: /spec/template/spec/containers/1/env/-
    value:
      name: DATABASE_SSL_ENABLED
      value: "true"
  - op: add
    path: /spec/template/spec/initContainers/0/env/-
    value:
      name: SAS_CERTIFICATE_SECRET_NAME
      value: pgo.tls
target:
  kind: Deployment
  name: sas-crunchy-data-postgres-operator
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-postgres-pgadmin-full-tls-transformer
patch: |-
  - op: add
    path: /spec/template/spec/initContainers/0/env/-
    value:
      name: SAS_CERTIFICATE_FILE
      value: /security/server.crt
  - op: add
    path: /spec/template/spec/initContainers/0/env/-
    value:
      name: SAS_CERTIFICATE_PRIVATE_KEY_FILE
      value: /security/server.key
  - op: add
    path: /spec/template/spec/initContainers/0/env/-
    value:
      name: SAS_CERTIFICATE_PRIVATE_KEY_PERMISSIONS
      value: "644"
  - op: add
    path: /spec/template/spec/containers/0/volumeMounts/-
    value:
      name: security
      mountPath: /certs
  - op: replace
    path: /spec/template/spec/containers/0/env/4
    value:
      name: ENABLE_TLS
      value: "true"
  - op: add
    path: /spec/template/spec/containers/0/env/-
    value:
      name: PGSSLROOTCERT
      value: "/security/trustedcerts.pem"
target:
  kind: Deployment
  name: sas-crunchy-data-pgadmin
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-service-espconfig-full-tls-transformer
patch: |-
  - op: replace
    path: /spec/projectTemplate/httpService/spec/ports/0/port
    value: 443
target:
  kind: ESPConfig
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-service-full-tls-transformer
patch: |-
  - op: replace
    path: /spec/ports/0/port
    value: 443
target:
  annotationSelector: sas.com/kustomize-base=base
  kind: Service
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-service-full-tls-transformer-prometheus
patch: |-
  - op: replace
    path: /metadata/annotations/prometheus.io~1port
    value: "443"
  - op: replace
    path: /metadata/annotations/prometheus.io~1scheme
    value: https
target:
  annotationSelector: prometheus.io/scrape=true
  kind: Service
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-shared-configmap-base-service-url-tls-transformer
patch: |-
  - op: replace
    path: /data/SAS_URL_SERVICE_SCHEME
    value: https
  - op: replace
    path: /data/SAS_URL_SERVICE_TEMPLATE
    value: https://@k8s.service.name@
target:
  kind: ConfigMap
  name: sas-shared-config
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-statefulset-base-tls-certframe-transformer
patch: |-
  kind: StatefulSet
  metadata:
    name: wildcard
  spec:
    template:
      spec:
        initContainers:
        - name: sas-certframe
          image: sas-certframe
          env:
          - name: KUBE_POD_NAME
            valueFrom:
              fieldRef:
                fieldPath: metadata.name
          - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
            value: /customer-provided-ca-certificates
          envFrom:
          - configMapRef:
              name: sas-certframe-ingress-certificate-config
          volumeMounts:
          - name: security
            mountPath: /security
          - name: customer-provided-ca-certificates
            mountPath: /customer-provided-ca-certificates
          securityContext:
            allowPrivilegeEscalation: false
            privileged: false
            readOnlyRootFilesystem: true
        volumes:
        - name: security
          emptyDir: {}
        - name: customer-provided-ca-certificates
          configMap:
            name: sas-customer-provided-ca-certificates
target:
  annotationSelector: sas.com/certificate-file-format in (pem, jks)
  kind: StatefulSet
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-statefulset-base-tls-volumeMount-transformer
patch: |-
  - op: add
    path: /spec/template/spec/containers/0/volumeMounts/-
    value:
      name: security
      mountPath: /security
  - op: add
    path: /spec/template/spec/containers/0/volumeMounts/-
    value:
      name: security
      mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
      subPath: cacerts
  - op: add
    path: /spec/template/spec/containers/0/volumeMounts/-
    value:
      name: security
      mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
      subPath: private
target:
  annotationSelector: sas.com/certificate-file-format in (pem, jks)
  kind: StatefulSet
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-statefulset-dbmigrator-base-tls-transformer
patch: |-
  kind: StatefulSet
  metadata:
    name: wildcard
  spec:
    template:
      spec:
        initContainers:
        - name: sas-db-migrator
          env:
          - name: SSL_CERT_FILE
            value: /security/trustedcerts.pem
          volumeMounts:
          - name: security
            mountPath: /security
target:
  annotationSelector: sas.com/pod-uses-db-migrator=true
  kind: StatefulSet
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-statefulset-full-tls-certframe-transformer
patch: |-
  - op: add
    path: /spec/template/metadata/annotations/sas.com~1tls-enabled-ports
    value: all
  - op: replace
    path: /spec/template/metadata/annotations/prometheus.io~1scheme
    value: https
  - op: add
    path: /spec/template/spec/initContainers/0/envFrom/-
    value:
      configMapRef:
        name: sas-certframe-user-config
target:
  annotationSelector: sas.com/certificate-file-format in (pem, jks)
  kind: StatefulSet
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-statefulset-full-tls-jks-configmap-transformer
patch: |-
  - op: add
    path: /spec/template/spec/containers/0/envFrom/-
    value:
      configMapRef:
        name: sas-java-tls-config
  - op: add
    path: /spec/template/spec/initContainers/0/envFrom/-
    value:
      configMapRef:
        name: sas-certframe-java-config
target:
  annotationSelector: sas.com/certificate-file-format=jks
  kind: StatefulSet
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-statefulset-full-tls-pem-configmap-transformer
patch: |-
  - op: add
    path: /spec/template/spec/containers/0/envFrom/-
    value:
      configMapRef:
        name: sas-tls-config
  - op: add
    path: /spec/template/spec/initContainers/0/envFrom/-
    value:
      configMapRef:
        name: sas-certframe-config
target:
  annotationSelector: sas.com/certificate-file-format=pem
  kind: StatefulSet
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-statefulset-sssd-base-tls-transformer
patch: |-
  kind: StatefulSet
  metadata:
    name: wildcard
  spec:
    template:
      spec:
        containers:
        - name: sssd
          env:
          - name: SSL_CERT_FILE
            value: /security/trustedcerts.pem
          volumeMounts:
          - name: security
            mountPath: /security
target:
  annotationSelector: sas.com/pod-uses-sssd=true
  kind: StatefulSet
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-tls-readiness-probe-transformer-deployments
patch: |-
  - op: replace
    path: /spec/template/spec/containers/0/readinessProbe/httpGet/scheme
    value: HTTPS
target:
  annotationSelector: sas.com/pod-uses-readiness-probe=http
  kind: Deployment
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: sas-tls-readiness-probe-transformer-espconfig
patch: |-
  - op: replace
    path: /spec/projectTemplate/deployment/spec/template/spec/containers/0/readinessProbe/httpGet/scheme
    value: HTTPS
target:
  kind: ESPConfig